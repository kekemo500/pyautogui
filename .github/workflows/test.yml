name: Detect Linux Environment

on:
  workflow_dispatch:

jobs:
  detect:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Detect Linux Distribution
        id: distro
        run: |
          if [ -f /etc/os-release ]; then
            . /etc/os-release
            echo "name=$NAME" >> $GITHUB_OUTPUT
            echo "version=$VERSION" >> $GITHUB_OUTPUT
          else
            echo "name=unknown" >> $GITHUB_OUTPUT
            echo "version=unknown" >> $GITHUB_OUTPUT
          fi

      - name: Detect GUI Availability
        id: gui
        run: |
          GUI="false"

          # Check session type (Wayland / X11)
          if [ ! -z "$XDG_SESSION_TYPE" ]; then
            GUI="true"
            SESSION="$XDG_SESSION_TYPE"
          fi

          # Check if display manager exists
          if systemctl list-unit-files | grep -E 'gdm|lightdm|sddm' >/dev/null; then
            GUI="true"
          fi

          # Check if Xorg exists
          if command -v Xorg >/dev/null 2>&1; then
            GUI="true"
          fi

          echo "gui=$GUI" >> $GITHUB_OUTPUT

      - name: Print Results
        run: |
          echo "===== Linux Distribution ====="
          echo "Name: ${{ steps.distro.outputs.name }}"
          echo "Version: ${{ steps.distro.outputs.version }}"

          echo "===== GUI Detection ====="
          echo "GUI Present: ${{ steps.gui.outputs.gui }}"
